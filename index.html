<!DOCTYPE html>
<html>
<head>
    <title>Code Edit</title>
    <link rel="stylesheet" href="codemirror/lib/codemirror.css">
    <link rel="stylesheet" href="codemirror/addon/dialog/dialog.css">
    <link rel="stylesheet" href="codemirror/addon/search/matchesonscrollbar.css">
    <link rel="stylesheet" href="codemirror/theme/3024-night.css">
    <link rel="stylesheet" href="codemirror/theme/ambiance.css">
    <link rel="stylesheet" href="codemirror/theme/base16-dark.css">
    <link rel="stylesheet" href="codemirror/theme/base16-light.css">
    <link rel="stylesheet" href="codemirror/theme/blackboard.css">
    <link rel="stylesheet" href="codemirror/theme/cobalt.css">
    <link rel="stylesheet" href="codemirror/theme/colorforth.css">
    <link rel="stylesheet" href="codemirror/theme/dracula.css">
    <link rel="stylesheet" href="codemirror/theme/eclipse.css">
    <link rel="stylesheet" href="codemirror/theme/elegant.css">
    <link rel="stylesheet" href="codemirror/theme/erlang-dark.css">
    <link rel="stylesheet" href="codemirror/theme/icecoder.css">
    <link rel="stylesheet" href="codemirror/theme/lesser-dark.css">
    <link rel="stylesheet" href="codemirror/theme/liquibyte.css">
    <link rel="stylesheet" href="codemirror/theme/material.css">
    <link rel="stylesheet" href="codemirror/theme/mbo.css">
    <link rel="stylesheet" href="codemirror/theme/mdn-like.css">
    <link rel="stylesheet" href="codemirror/theme/midnight.css">
    <link rel="stylesheet" href="codemirror/theme/monokai.css">
    <link rel="stylesheet" href="codemirror/theme/neat.css">
    <link rel="stylesheet" href="codemirror/theme/neo.css">
    <link rel="stylesheet" href="codemirror/theme/night.css">
    <link rel="stylesheet" href="codemirror/theme/paraiso-dark.css">
    <link rel="stylesheet" href="codemirror/theme/paraiso-light.css">
    <link rel="stylesheet" href="codemirror/theme/pastel-on-dark.css">
    <link rel="stylesheet" href="codemirror/theme/rubyblue.css">
    <link rel="stylesheet" href="codemirror/theme/seti.css">
    <link rel="stylesheet" href="codemirror/theme/solarized.css">
    <link rel="stylesheet" href="codemirror/theme/the-matrix.css">
    <link rel="stylesheet" href="codemirror/theme/tomorrow-night-bright.css">
    <link rel="stylesheet" href="codemirror/theme/tomorrow-night-eighties.css">
    <link rel="stylesheet" href="codemirror/theme/ttcn.css">
    <link rel="stylesheet" href="codemirror/theme/twilight.css">
    <link rel="stylesheet" href="codemirror/theme/vibrant-ink.css">
    <link rel="stylesheet" href="codemirror/theme/xq-dark.css">
    <link rel="stylesheet" href="codemirror/theme/xq-light.css">
    <link rel="stylesheet" href="codemirror/theme/yeti.css">
    <link rel="stylesheet" href="codemirror/theme/zenburn.css">
    <link rel="stylesheet" href="style.css">

    <script type="text/javascript" src="codemirror/lib/codemirror.js"></script>
    <script type="text/javascript" src="codemirror/mode/javascript/javascript.js"></script>

    <script src="codemirror/addon/display/placeholder.js"></script>
    <script src="codemirror/addon/display/rulers.js"></script>
    <script src="codemirror/addon/edit/trailingspace.js"></script>
    <script src="codemirror/addon/edit/closebrackets.js"></script>
    <script src="codemirror/addon/selection/active-line.js"></script>
    <script src="codemirror/addon/dialog/dialog.js"></script>
    <script src="codemirror/addon/search/searchcursor.js"></script>
    <script src="codemirror/addon/search/search.js"></script>
    <script src="codemirror/addon/display/fullscreen.js"></script>
    <script src="codemirror/addon/display/panel.js"></script>

    <script src="codemirror/mode/apl/apl.js"></script>
    <script src="codemirror/mode/asciiarmor/asciiarmor.js"></script>
    <script src="codemirror/mode/asn.1/asn.1.js"></script>
    <script src="codemirror/mode/asterisk/asterisk.js"></script>
    <script src="codemirror/mode/brainfuck/brainfuck.js"></script>
    <script src="codemirror/mode/clike/clike.js"></script>
    <script src="codemirror/mode/clojure/clojure.js"></script>
    <script src="codemirror/mode/cmake/cmake.js"></script>
    <script src="codemirror/mode/cobol/cobol.js"></script>
    <script src="codemirror/mode/coffeescript/coffeescript.js"></script>
    <script src="codemirror/mode/commonlisp/commonlisp.js"></script>
    <script src="codemirror/mode/css/css.js"></script>
    <script src="codemirror/mode/cypher/cypher.js"></script>
    <script src="codemirror/mode/dart/dart.js"></script>
    <script src="codemirror/mode/diff/diff.js"></script>
    <script src="codemirror/mode/django/django.js"></script>
    <script src="codemirror/mode/dtd/dtd.js"></script>
    <script src="codemirror/mode/dylan/dylan.js"></script>
    <script src="codemirror/mode/ebnf/ebnf.js"></script>
    <script src="codemirror/mode/ecl/ecl.js"></script>
    <script src="codemirror/mode/eiffel/eiffel.js"></script>
    <script src="codemirror/mode/erlang/erlang.js"></script>
    <script src="codemirror/mode/forth/forth.js"></script>
    <script src="codemirror/mode/fortran/fortran.js"></script>
    <script src="codemirror/mode/gas/gas.js"></script>
    <script src="codemirror/mode/gfm/gfm.js"></script>
    <script src="codemirror/mode/gherkin/gherkin.js"></script>
    <script src="codemirror/mode/groovy/groovy.js"></script>
    <script src="codemirror/mode/haml/haml.js"></script>
    <script src="codemirror/mode/haskell/haskell.js"></script>
    <script src="codemirror/mode/haxe/haxe.js"></script>
    <script src="codemirror/mode/htmlembedded/htmlembedded.js"></script>
    <script src="codemirror/mode/htmlmixed/htmlmixed.js"></script>
    <script src="codemirror/mode/http/http.js"></script>
    <script src="codemirror/mode/idl/idl.js"></script>
    <script src="codemirror/mode/jade/jade.js"></script>
    <script src="codemirror/mode/javascript/javascript.js"></script>
    <script src="codemirror/mode/jinja2/jinja2.js"></script>
    <script src="codemirror/mode/julia/julia.js"></script>
    <script src="codemirror/mode/kotlin/kotlin.js"></script>
    <script src="codemirror/mode/livescript/livescript.js"></script>
    <script src="codemirror/mode/lua/lua.js"></script>
    <script src="codemirror/mode/markdown/markdown.js"></script>
    <script src="codemirror/mode/mathematica/mathematica.js"></script>
    <script src="codemirror/mode/mirc/mirc.js"></script>
    <script src="codemirror/mode/mllike/mllike.js"></script>
    <script src="codemirror/mode/modelica/modelica.js"></script>
    <script src="codemirror/mode/mumps/mumps.js"></script>
    <script src="codemirror/mode/nginx/nginx.js"></script>
    <script src="codemirror/mode/ntriples/ntriples.js"></script>
    <script src="codemirror/mode/octave/octave.js"></script>
    <script src="codemirror/mode/pascal/pascal.js"></script>
    <script src="codemirror/mode/pegjs/pegjs.js"></script>
    <script src="codemirror/mode/perl/perl.js"></script>
    <script src="codemirror/mode/php/php.js"></script>
    <script src="codemirror/mode/pig/pig.js"></script>
    <script src="codemirror/mode/properties/properties.js"></script>
    <script src="codemirror/mode/puppet/puppet.js"></script>
    <script src="codemirror/mode/python/python.js"></script>
    <script src="codemirror/mode/rpm/rpm.js"></script>
    <script src="codemirror/mode/rst/rst.js"></script>
    <script src="codemirror/mode/ruby/ruby.js"></script>
    <script src="codemirror/mode/rust/rust.js"></script>
    <script src="codemirror/mode/sass/sass.js"></script>
    <script src="codemirror/mode/scheme/scheme.js"></script>
    <script src="codemirror/mode/shell/shell.js"></script>
    <script src="codemirror/mode/sieve/sieve.js"></script>
    <script src="codemirror/mode/slim/slim.js"></script>
    <script src="codemirror/mode/smalltalk/smalltalk.js"></script>
    <script src="codemirror/mode/smarty/smarty.js"></script>
    <script src="codemirror/mode/solr/solr.js"></script>
    <script src="codemirror/mode/soy/soy.js"></script>
    <script src="codemirror/mode/sparql/sparql.js"></script>
    <script src="codemirror/mode/spreadsheet/spreadsheet.js"></script>
    <script src="codemirror/mode/sql/sql.js"></script>
    <script src="codemirror/mode/stex/stex.js"></script>
    <script src="codemirror/mode/stylus/stylus.js"></script>
    <script src="codemirror/mode/swift/swift.js"></script>
    <script src="codemirror/mode/tcl/tcl.js"></script>
    <script src="codemirror/mode/textile/textile.js"></script>
    <script src="codemirror/mode/tiddlywiki/tiddlywiki.js"></script>
    <script src="codemirror/mode/tiki/tiki.js"></script>
    <script src="codemirror/mode/toml/toml.js"></script>
    <script src="codemirror/mode/tornado/tornado.js"></script>
    <script src="codemirror/mode/troff/troff.js"></script>
    <script src="codemirror/mode/ttcn/ttcn.js"></script>
    <script src="codemirror/mode/ttcn-cfg/ttcn-cfg.js"></script>
    <script src="codemirror/mode/turtle/turtle.js"></script>
    <script src="codemirror/mode/twig/twig.js"></script>
    <script src="codemirror/mode/vbscript/vbscript.js"></script>
    <script src="codemirror/mode/velocity/velocity.js"></script>
    <script src="codemirror/mode/verilog/verilog.js"></script>
    <script src="codemirror/mode/vhdl/vhdl.js"></script>
    <script src="codemirror/mode/xml/xml.js"></script>
    <script src="codemirror/mode/xquery/xquery.js"></script>
    <script src="codemirror/mode/yaml/yaml.js"></script>
    <script src="codemirror/mode/z80/z80.js"></script>
</head>
<body>
    <script type="text/javascript">
        window.$ = window.jQuery = require(__dirname + '/js/jquery-2.1.4.min.js');

        $(document).ready(function() {
            var remote = require('remote');
            var dialog = remote.require('dialog');
            var fs = require('fs');

            var CodeEditor = CodeMirror.fromTextArea(
                document.getElementById('editor'),
                {
                    placeholder: 'Code goes here...',
                    viewportMargin: Infinity,
                    rulers: [
                        {
                            color: '#ccc',
                            column: 120,
                            lineStyle: 'dashed'
                        }
                    ],
                    showTrailingSpace: true,
                    lineNumbers: true,
                    styleActiveLine: true,
                    autoCloseBrackets: true,
                    matchBrackets: true,
                    lineWrapping: true,
                    indentUnit: 4,
                    smartIndent: true,
                    tabSize: 4,
                    indentWithTabs: false,
                    autofocus: true,
                    extraKeys: {
                        'Ctrl-Space': 'autocomplete',
                        'Ctrl-F': 'findPersistent',
                        'Ctrl-P': function(cm) {
                            return cm.openDialog(
                                $('#dialog').html(),
                                function(cmd) {
                                    var cmds = cmd.split(' ');
                                    if (cmds.length < 1)
                                        return false;

                                    var cmd = cmds.shift();
                                    switch (cmd) {
                                        case 'open':
                                            return openFile(cmds);
                                        case 'save':
                                            saveFile();
                                    }
                                }
                            );
                        },
                        'Ctrl-S': saveFile
                    },
                    globalVars: true
                }
            );

        function basename(path) {
            return path.split('/').reverse()[0];
        }

        function open(fileName) {
            fs.readFile(fileName, 'utf-8', function(err, data) {
                $('#fileName').val(fileName);
                CodeEditor.setValue(data);

                var name = basename(fileName);
                var add = true;

                $('#open-files li').each(function() {
                    if ($(this).text() == name) {
                        add = false;
                        return true;
                    }
                });

                if (add)
                    $('#open-files').append($('<li>').text(name));
            });
        }

        function openFile(file) {
            if (file !== undefined && file.length > 0) {
                var fileName = $.trim(file);
                return open(__dirname + '/' + file);
            }

            dialog.showOpenDialog(function(fileNames) {
                if (fileNames === undefined)
                    return;

                var fileName = fileNames[0];
                return open(fileName);
            });
        }

        function save(fileName) {
            fs.writeFile(fileName, CodeEditor.getValue(), function (err) {
                if (err)
                    alert(err);
            });
        }

        function saveFile() {
            var fileName = $('#fileName').val();
            if (fileName.length != 0) {
                return save(fileName);
            }

            dialog.showSaveDialog(function(fileName) {
                if (fileName === undefined)
                    return;

                return save(fileName);
            });
        }

        $('#open-files').on('click', 'li', function() {
            var name = $(this).text();
            open(__dirname + '/' + name);
        });

        $('#theme').change(function() {
            var theme = $(this).find('option:selected').val();
            CodeEditor.setOption('theme', theme);
        });

        $('#mode').change(function() {
            var mode = $(this).find('option:selected').val();
            CodeEditor.setOption('mode', mode);
        });
    });
    </script>
    <div id="dialog" style="display: none">
        <input type="text" value="" name="cmd" id="cmd" />
    </div>

    <p>
        <input type="hidden" name="fileName" id="fileName" value="" />
    </p>

    <p>
        <ul id="open-files"></ul>
        <textarea id="editor" name="editor"></textarea>
    </p>

    <div class="theme">
        <p>Select a language:</p>
        <select id="mode" class="mode">
            <option>apl</option>,
            <option>asciiarmor</option>,
            <option>asn.1</option>,
            <option>asterisk</option>,
            <option>brainfuck</option>,
            <option>clike</option>,
            <option>clojure</option>,
            <option>cmake</option>,
            <option>cobol</option>,
            <option>coffeescript</option>,
            <option>commonlisp</option>,
            <option>css</option>,
            <option>cypher</option>,
            <option>dart</option>,
            <option>diff</option>,
            <option>django</option>,
            <option>dockerfile</option>,
            <option>dtd</option>,
            <option>dylan</option>,
            <option>ebnf</option>,
            <option>ecl</option>,
            <option>eiffel</option>,
            <option>elm</option>,
            <option>erlang</option>,
            <option>factor</option>,
            <option>forth</option>,
            <option>fortran</option>,
            <option>gas</option>,
            <option>gfm</option>,
            <option>gherkin</option>,
            <option>groovy</option>,
            <option>haml</option>,
            <option>handlebars</option>,
            <option>haskell</option>,
            <option>haxe</option>,
            <option>htmlembedded</option>,
            <option>htmlmixed</option>,
            <option>http</option>,
            <option>idl</option>,
            <option>jade</option>,
            <option>javascript</option>,
            <option>jinja2</option>,
            <option>julia</option>,
            <option>kotlin</option>,
            <option>livescript</option>,
            <option>lua</option>,
            <option>markdown</option>,
            <option>mathematica</option>,
            <option>mirc</option>,
            <option>mllike</option>,
            <option>modelica</option>,
            <option>mumps</option>,
            <option>nginx</option>,
            <option>ntriples</option>,
            <option>octave</option>,
            <option>pascal</option>,
            <option>pegjs</option>,
            <option>perl</option>,
            <option>php</option>,
            <option>pig</option>,
            <option>properties</option>,
            <option>puppet</option>,
            <option>python</option>,
            <option>rpm</option>,
            <option>rst</option>,
            <option>ruby</option>,
            <option>rust</option>,
            <option>sass</option>,
            <option>scheme</option>,
            <option>shell</option>,
            <option>sieve</option>,
            <option>slim</option>,
            <option>smalltalk</option>,
            <option>smarty</option>,
            <option>solr</option>,
            <option>soy</option>,
            <option>sparql</option>,
            <option>spreadsheet</option>,
            <option>sql</option>,
            <option>stex</option>,
            <option>stylus</option>,
            <option>swift</option>,
            <option>tcl</option>,
            <option>textile</option>,
            <option>tiddlywiki</option>,
            <option>tiki</option>,
            <option>toml</option>,
            <option>tornado</option>,
            <option>troff</option>,
            <option>ttcn</option>,
            <option>ttcn-cfg</option>,
            <option>turtle</option>,
            <option>twig</option>,
            <option>vbscript</option>,
            <option>velocity</option>,
            <option>verilog</option>,
            <option>vhdl</option>,
            <option>xml</option>,
            <option>xquery</option>,
            <option>yaml</option>,
            <option>z80</option>
        </select>
    </div>

    <div class="mode">
        <p>Select a theme:</p>
        <select id="theme" class="theme">
            <option>default</option>,
            <option>3024-day</option>,
            <option>3024-night</option>,
            <option>ambiance</option>,
            <option>base16-dark</option>,
            <option>base16-light</option>,
            <option>blackboard</option>,
            <option>cobalt</option>,
            <option>colorforth</option>,
            <option>dracula</option>,
            <option>eclipse</option>,
            <option>elegant</option>,
            <option>erlang-dark</option>,
            <option>icecoder</option>,
            <option>lesser-dark</option>,
            <option>liquibyte</option>,
            <option>material</option>,
            <option>mbo</option>,
            <option>mdn-like</option>,
            <option>midnight</option>,
            <option>monokai</option>,
            <option>neat</option>,
            <option>neo</option>,
            <option>night</option>,
            <option>paraiso-dark</option>,
            <option>paraiso-light</option>,
            <option>pastel-on-dark</option>,
            <option>rubyblue</option>,
            <option>seti</option>,
            <option>solarized dark</option>,
            <option>solarized light</option>,
            <option>the-matrix</option>,
            <option>tomorrow-night-bright</option>,
            <option>tomorrow-night-eighties</option>,
            <option>ttcn</option>,
            <option>twilight</option>,
            <option>vibrant-ink</option>,
            <option>xq-dark</option>,
            <option>xq-light</option>,
            <option>yeti</option>,
            <option>zenburn</option>
        </select>
    </div>
</body>
</html>
